version: '3.8'

services:
  # Frontend React
  frontend:
    image: ghcr.io/guilhermerodrigues-10/gv-marketing-frontend:latest
    networks:
      - GovisaNet
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
      labels:
        - traefik.enable=true
        - traefik.http.routers.gv_marketing_frontend.rule=Host(`tasks.gvmarketing.us`)
        - traefik.http.routers.gv_marketing_frontend.entrypoints=websecure
        - traefik.http.routers.gv_marketing_frontend.priority=1
        - traefik.http.routers.gv_marketing_frontend.tls.certresolver=letsencryptresolver
        - traefik.http.routers.gv_marketing_frontend.service=gv_marketing_frontend
        - traefik.http.services.gv_marketing_frontend.loadbalancer.server.port=80
        - traefik.http.services.gv_marketing_frontend.loadbalancer.passHostHeader=1

  # Backend Node.js
  backend:
    image: ghcr.io/guilhermerodrigues-10/gv-marketing-backend:latest
    networks:
      - GovisaNet
    environment:
      - NODE_ENV=production
      - PORT=3001
      - FRONTEND_URL=https://tasks.gvmarketing.us
      - JWT_SECRET=9b1af44452364c0ef77cf19d7b0fb495868320c2f7f31bf98ed8a00c5a9dc08b6aef35e6db6ef407daed9025c4b948128dbe685f48d91679c6885ccdb5639bda
      - JWT_EXPIRES_IN=7d
      - DB_HOST=aws-0-us-west-2.pooler.supabase.com
      - DB_PORT=6543
      - DB_NAME=postgres
      - DB_USER=postgres.hywyqckkahlxevvtzkfw
      - DB_PASSWORD=1N6sup0mk3x5R0ym
      - SUPABASE_URL=https://hywyqckkahlxevvtzkfw.supabase.co
      - SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5d3lxY2trYWhseGV2dnR6a2Z3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0MDAyMTUsImV4cCI6MjA4MDk3NjIxNX0.Gc8rHZfSIWVNiyUP43eRqCLD6i80CPS7YiiZct0rmHg
      - ADMIN_EMAIL=admin@gvmarketing.com
      - ADMIN_PASSWORD=GVMarketing2024!@Secure
      - DROPBOX_ACCESS_TOKEN=sl.u.AGKPVgjV0Us6fp95UGLAMFAPnmCCedn-BqQPNh6giV6GICb8FATDMkLfD82IJ3Q_Ym6h619mh7Ai7ECUJKFPCEf0wJr8P59yblTMZp-G1drt4HdcmTeawcat-hKhd7OQXdOg-ln3j6ctlB0RVh570ZEli1t6nCry9Sjo0NbSaz7X6AX5YQ8DoqQPZRDH9D6sVoo88AqxP91xbO_uyksU7irP-ViTqUeWxuZWKPwWMf13l5ubLfrm2GPWy3EUyys0ZNWMHW-eVcS8EHOx4-l7jSYusPvJu6uD1miViuP8gr-dvXrvx-es9BxYXZlFGk9J05MsEg8QMuD7VbG68HWalVjRE1gcviDg5X_1UeBQWGCrTPo6FYDEaW0XH7xmirpJQcDBEb5Yk5RjhabhJALFKSovhpRfjq2LTLV93mWdsgbqUv3Us_WjEjNLYt4x-Xoev-IkaB_U7Tth5Ji-iD3ht6dciTlMp6ylnCEvDF20jQnyEOb1uNOSFVs7GxnwG7_PfDd1MZvHDUEcX7JIuNvwqPF53Lb_B6aGPLC_bJ1CSSua3BL51VCakYfNJIBBMDfHPReT41e246gkEoSHrxADEC9s3JclnvaqEUjjeQbsLsLjVStzMFYExrlJQnKnm8rbYd5pbBFjZaud8awsq98O964hyv5uGtRTJDWzR47PKavxkZnYi1-JmqQuyfBRP2DZefIVkA4jB00HaLnimBDa5B3igVHCcdncFqdBXkipqHtJmBgJPBIk_BlAjkRq9POACOrCB-teOVh5NAbGbXxHPhBRA-CniE8CgFhO8OrFuI9MsN7Ulfop2bhSPYdiFfEKx1I8BZ0DIA9IEJum-O5w7GsnV5oo5opw9BDRB3IWt8zfzjlIx0QN-YiVIb96XUL8roAuEe6XfYxHK0leJs3o-AhtCIkNDrrRLBGJtGiXDHi9-n0WEsrdTcIme41SIKC53-QA0EKi9LxC53CpmYgDx7WUYkv8NBd5T248nDbfVYvZwwWvdO9lgeNLVERGP2TDPDnmiyLm0wBnHLmBizxb1GqpLsNGPSa2p3e9FfYEmNSy4U4PHj9nUjNQWk862MYXWb6V8ut97vlLuUkFUMNncDHCEV8NGzLZ9jLXOsjvLwOCIIyGCA9RIaPgKFcMc3MYLNSft-sejc8szIVZJPCLTCpHxeFsYb6tPlb_hfoTzPqd_lghGajhmP_RXBsCeYEF3cBUeBqfPkuWG1XOzvg4OY3mAG7gov6FB_lDKNqJ2irvC6-zjElX35a3XkmblcD_BQTnd4ZWW7HCVnkzDe57Vl7OvSkLaCI2A9QWhVaZFRq7_Gs8LcZtiLMsT0kgbSi1UlNO1chbQ5CPMvRRa0F_8RUKFct3Hmt0e0zPr1BnN6rH2Wm7nrTFJwRWVqNqQGhSnYLlX6yWJ3ePoB5p35tVjCUVkUTElJBBaQa0rCJGYeBZClRjXnB88czP20xkGa8Q3I4EGj0Q6liNmNx3xIX8Ht3jIznK8zb7qrD5d7mDqx1nAYCrs_k0Uaaf0yJJI8rtgmI
    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
      labels:
        - traefik.enable=true
        - traefik.http.routers.gv_marketing_backend.rule=Host(`tasks.gvmarketing.us`) && (PathPrefix(`/api`) || PathPrefix(`/socket.io`))
        - traefik.http.routers.gv_marketing_backend.entrypoints=websecure
        - traefik.http.routers.gv_marketing_backend.priority=100
        - traefik.http.routers.gv_marketing_backend.tls.certresolver=letsencryptresolver
        - traefik.http.routers.gv_marketing_backend.service=gv_marketing_backend
        - traefik.http.services.gv_marketing_backend.loadbalancer.server.port=3001
        - traefik.http.services.gv_marketing_backend.loadbalancer.server.scheme=http

networks:
  GovisaNet:
    external: true
    name: GovisaNet
